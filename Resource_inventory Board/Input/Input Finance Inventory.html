<html lang="en" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <head>
    <title>Cost Input</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://webeocboardfiles.juvare.com/board/1.0/css/material-kit.min.css" />
    <link rel="stylesheet" href="https://webeocboardfiles.juvare.com/board/1.0/lib/flatpickr/flatpickr.min.css" />
  </head>
  <body class="bg-faded-grey-light">
    <form aria-label="Data" class="mb-0" id="input-form">
      <insertfields>
        <field name="cost_position">@positionname</field>
        <field name="originating_name">@sessionname</field>
      </insertfields>
      <nav class="navbar navbar-default navbar-expand-lg" aria-label="Navigation">
        <header class="container-fluid flex-left" aria-label="Header">
          <div class="img-agencyinfo mr-3 mobile-hide-lg">
            <agencyinfo type="primarylogo" />
          </div>
          <div>
            <h1 class="boardname">
              <b>
                <choose>
                  <when test="//@dataid = 0">New Record</when>
                  <otherwise>Edit Record</otherwise>
                </choose>
              </b>
            </h1>
            <h2 class="incidentname">
              <span>Cost Record for #</span>
              <value-of select="//@tracking_number" />
            </h2>
          </div>
        </header>
      </nav>
      <main aria-label="Main Section" class="container-fluid container-max-width py-2 my-2 form-border">
        <section>
          <h2 class="section-header">
            <b>Cost Information</b>
          </h2>
          <div class="form-row">
            
            <div class="form-group col-12">
              <label class="form-label required">Cost Description</label>
              <input type="text" name="cost_description" class="form-control" required="true" label="Cost Description" />
              <div class="invalid-feedback">Please provide a cost description.</div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6 col-sm-12">
              <label class="form-label required">Total Cost/Estimate</label>
              <div class="form-inline">
                <span>$</span>
                <!-- PATTERN FOR COMMA AS THOUSANDS SEPERATOR AND DECIMAL AS FRACTIONAL SEPERATOR -->
                <input type="text" name="cost_total" fieldtype="nvarchar" id="cost_total" class="form-control" style="width:calc(100% - 1em);" required="true" pattern="^(\$)?([1-9]{{1}}[0-9]{{0,2}})(\,\d{{3}})*(\.\d{{2}})?$|^(\$)?([1-9]{{1}}[0-9]{{0,2}})(\d{{3}})*(\.\d{{2}})?$|^(0)?(\.\d{{2}})?$|^(\$0)?(\.\d{{2}})?$|^(\$\.)(\d{{2}})?$" label="Total Cost/Estimate" />
                <!-- PATTERN FOR DECIMAL AS THOUSANDS SEPERATOR AND COMMA AS FRACTIONAL SEPERATOR -->
                <!-- <input type="text" name="cost_total" id="cost_total" class="form-control" style="width:calc(100% - 1em);" required="true" pattern="^(\$)?([1-9]{{1}}[0-9]{{0,2}})(\.\d{{3}})*(\,\d{{2}})?$|^(\$)?([1-9]{{1}}[0-9]{{0,2}})(\d{{3}})*(\,\d{{2}})?$|^(0)?(\,\d{{2}})?$|^(\$0)?(\,\d{{2}})?$|^(\$\,)(\d{{2}})?$" label="Total Cost/Estimate"/> -->
                <div class="invalid-feedback">Please provide a valid total cost/estimate.</div>
              </div>
            </div>
            <div class="form-group col-md-6 col-sm-12">
              <label class="form-label required">Resource Vendor/Provider</label>
              <input type="text" name="cost_vendor" class="form-control" required="true" label="Resource Vendor/Provider" />
              <div class="invalid-feedback">Please provide a resource vendor/provider.</div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6 col-sm-12">
              <label class="form-label">Invoice Number</label>
              <input type="text" name="cost_invoice_number" class="form-control" label="Invoice Number" />
            </div>
            <div class="form-group col-md-6 col-sm-12">
              <label class="form-label">Purchase Order Number</label>
              <input type="text" name="cost_po_number" class="form-control" label="PO Number" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group bmd-form-group col-md-3" id="i62xz7h">
                <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="accounting_string" id="iy3ugaf">Accounting String</label>
                <input name="accounting_string" type="text" class="form-control" label="Accounting String" id="accounting_string"/>
            </div>
            <div class="form-group bmd-form-group col-md-3" id="igqzz5p">
                <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="purchasing_authority" id="iefrfdo">Purchasing Authority</label>
                <input name="purchasing_authority" type="text" class="form-control" label="Purchasing Authority" id="purchasing_authority"/>
            </div>
            <div class="form-group bmd-form-group col-md-3" id="imaww3r">
                <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="line_description" id="ic6y1ao">Line Description<div class="help-text-container ml-2"><i class="material-icons cursor-default faded-grey" data-toggle="tooltip" data-placement="right" title="FLIR RIID Last three of SN" style="line-height: .5; font-size: 1.6em;" id="iugblka">help</i></div></label>
                <input name="line_description" type="text" class="form-control" label="Line Description" id="line_description"/>
            </div>
            <div class="form-group bmd-form-group col-md-3" id="is541im">
                <div class="form-check">
                    <label class="form-check-label d-flex align-items-center form-label" for="submitted_in_advantage">
                        <input type="checkbox" name="submitted_in_advantage" class="form-check-input form-control" value="Yes" label="Submitted in Advantage" id="submitted_in_advantage"/>
                        Submitted in Advantage
                        <span class="form-check-sign">
                            <span class="check"/>
                        </span>
                    </label>
                </div>
            </div>
        </div>
        <div class="form-row">
          <div class="form-group bmd-form-group col-md-4" >
              <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="fema_cost_code" id="i98tvf">FEMA cost Code</label>
              <select name="fema_cost_code" class="form-control" label="FEMA cost Code" id="fema_cost_code" list="inventory_fema_cost_code"/>
          </div>
          <div class="form-group bmd-form-group col-md-4" >
              <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="fema_equipment_rate" id="iy0mna">FEMA Equipment Rate</label>
              <input name="fema_equipment_rate" type="number" class="form-control" fieldtype="int" label="FEMA Equipment Rate (whole numbers only)" id="fema_equipment_rate"></input>
          </div>
          <div class="form-group bmd-form-group col-md-4" >
              <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="fema_rate_unit" >FEMA Rate Unit</label>
              <select name="fema_rate_unit" class="form-control" label="FEMA Rate Unit" id="fema_rate_unit" list="inventory_fema_rate_unit" defaulttext="hour"></select>
          </div>
      </div>
      <div class="form-row">
        <div class="form-group bmd-form-group col">
            <div class="form-check">
                <label class="form-check-label d-flex align-items-center form-label" for="mou_or_other_purchase_agreement_active_">
                    <input type="checkbox" name="mou_or_other_purchase_agreement_active_" class="form-check-input form-control" value="Yes" label="MOU or other purchase agreement active?" id="mou_or_other_purchase_agreement_active_"/>
                    <strong class="text-primary">
                        <em>MOU or other purchase agreement active?</em>
                    </strong>
                    <span class="form-check-sign">
                        <span class="check"/>
                    </span>
                </label>
            </div>
          </div>
          
            <div class="form-group bmd-form-group col">
              <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="mou_tracking_info" id="ix6tvtu">Relevant MOU and/or Purchase agreement information<div class="help-text-container ml-2"><i class="material-icons cursor-default faded-grey" data-toggle="tooltip" data-placement="right" title="could be the agency name, or purchase order number or any other information that associates this item with a specific MOU and/or standing purchase agreement" style="line-height: .5; font-size: 1.6em;" id="i9jha8x">help</i></div></label>
              <input name="mou_tracking_info" type="text" class="form-control" label="Enter MOU and/or purchase agreement tracking information" id="mou_tracking_info"/>
              
          </div>
        
    </div>
    <div class="form-row">
      <div class="form-group bmd-form-group col-md-4" id="iiobin">
          <label class="form-label d-flex align-items-center" style="pointer-events: auto">Grant Type</label>
          <div class="form-check form-check-radio">
              <label class="form-check-label"><input type="radio" name="grant_type" value="grant_uasi" label="Grant Type" class="form-check-input"/>UASI<span class="circle"><span class="check"/></span></label>
          </div>
          <div class="form-check form-check-radio">
              <label class="form-check-label"><input type="radio" name="grant_type" value="grant_shsgp" label="Grant Type" class="form-check-input"/>SHSGP<span class="circle"><span class="check"/></span></label>
          </div>
          <div class="form-check form-check-radio">
              <label class="form-check-label"><input type="radio" name="grant_type" value="grant_empg" label="Grant Type" class="form-check-input"/>EMPG<span class="circle"><span class="check"/></span></label>
          </div>
          <div class="form-check form-check-radio">
              <label class="form-check-label"><input type="radio" name="grant_type" value="grant_stc" label="Grant Type" class="form-check-input"/>STC<span class="circle"><span class="check"/></span></label>
          </div>
          <div class="form-check form-check-radio">
              <label class="form-check-label"><input type="radio" name="grant_type" value="grant_other" label="Grant Type" class="form-check-input"/>Unknown/Other<span class="circle"><span class="check"/></span></label>
          </div>
      </div>
      <div class="form-group bmd-form-group col-md-4" id="i1iu8y">
          <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="grant_year" id="ikfiqk">Grant Year</label>
          <input name="grant_year" type="text" class="form-control" label="Grant Year" id="grant_year"/>
      </div>
      <div class="form-group bmd-form-group col-md-4" id="i1p15d">
          <label class="form-label d-flex align-items-center" style="pointer-events: auto" for="grant_number" id="iw2059">Grant Number</label>
          <input name="grant_number" type="text" class="form-control" label="Grant Number" id="grant_number"/>
      </div>
  </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Comments</label>
              <textarea name="cost_comments" rows="4" class="form-control" label="Comments" ></textarea>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6 col-sm-12">
              <div class="form-group form-file-upload form-file-simple has-feedback ">
                <label class="form-label">Attachment</label>
                <div class="input-group">
                  <input name="cost_attachment_1_name" type="text" class="form-control inputFileVisible" placeholder="Click to browse" readonly="readonly" label="Attachment Name" />
                  <input name="cost_attachment_1" type="file" class="inputFileHidden" data-file-name-field="cost_attachment_1_name" label="Attachment" />
                </div>
              </div>
            </div>
            <div class="form-group col-md-6 col-sm-12">
              <label class="form-label">Attachment Description</label>
              <input type="text" name="cost_attachment_1_description" class="form-control" label="Attachment Description" />
            </div>
          </div>
        </section>
        <section class="d-none">
          <h2 class="section-header">Hidden Fields</h2>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Remove Record</label>
              <input type="text" name="cost_remove" class="form-control" label="Remove Record" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Originator Position</label>
              <input type="text" name="originating_position" class="form-control" label="Originator Position" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Originator Agency</label>
              <input type="text" name="originating_agency" id="originating_agency" class="form-control" label="Originator Agency" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Originator Agency Group</label>
              <input type="text" name="originating_agency_group" id="originating_agency_group" class="form-control" label="Originator Agency Group" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Originator Name</label>
              <input type="text" name="originating_name" class="form-control" label="Originator Name" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Foreign Key</label>
              <br />
              <span id="fk-holder">
                <foreignkey table="Resource Request Table">
                  <eocfield type="fk" table="Resource Request Table" name="tracking_number" />
                  <eocfield type="fk" table="Resource Request Table" name="task_desc_short" />
                  <eocfield type="fk" table="Resource Request Table" name="status" />
                </foreignkey>
              </span>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Foreign Key Table</label>
              <br />
              <span id="fk-table-holder">
                <foreignkeyreference table="Resource Request Table" />
              </span>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Mission Tracking Number</label>
              <input type="text" name="cost_mission_tracking_number" class="form-control" label="Mission Tracking Number">
                <attribute name="value">
                  <value-of select="//@tracking_number" />
                </attribute>
              </input>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Mission Name</label>
              <input type="text" name="cost_mission_name" class="form-control" label="Mission Name">
                <attribute name="value">
                  <value-of select="//@task_desc_short" />
                </attribute>
              </input>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">Originating Position</label>
              <input type="text" name="cost_position" class="form-control" label="Originating Position" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">BoardScript Viewlinks</label>
              <br />
              <viewlink name="BoardScript - History Input" table="History Table">BoardScript - History Input</viewlink>
              <viewlink name="BoardScript - Update Request">BoardScript - Update Request</viewlink>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-12">
              <label class="form-label">User Data Holder</label>
              <br />
              <span id="user-data-holder" data-status="{//@status}" data-dataid="{/data/@dataid}" data-username="{/data/@username}" data-sessionname="{/data/SessionDetail/Sessions/@name}" data-realname="{/data/userdetail/@realname}" data-positionname="{/data/@positionname}" />
            </div>
          </div>
        </section>
        <section class="text-right" aria-label="Footer">
          <returnbutton button="return-button" class="btn btn-sm btn-outline-primary mr-2">Cancel</returnbutton>
          <savebutton class="btn btn-sm btn-primary">Save</savebutton>
        </section>
      </main>
    </form>
    <grouplist />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/core/jquery.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/core/popper.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/plugins/moment.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/core/bootstrap-material-design.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/material-kit.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/lib/flatpickr/flatpickr.min.js" />
    <script src="https://webeocboardfiles.juvare.com/board/1.0/js/ux-webeoc-board-standards.min.js" />
    <script boardresource="jquery.maskMoney.min.js" type="text/javascript" />
    <script>
			  (function(window, $) {
				"use strict";

				$('#cost_total').maskMoney({
					thousands: ',',
					decimal: '.',
					allowZero: true
				});
				
				wireAgency();

				$('[name="cmdSave"]').on('click', function () {
					var validationResponse = BoardUI.validation.validateForm();
					if (!validationResponse.isValid) {
						if (validationResponse.errorFields.length &gt; 1){
							var message = "These fields need your attention:\n\n";
							validationResponse.errorFields.forEach(field =&gt; {
								message += "• " + (field.getAttribute("label") || field.getAttribute("name")) + "\n";
							})
						} else {
							var message = "This field needs your attention: ";
							message += (validationResponse.errorFields[0].getAttribute("label") || validationResponse.errorFields[0].getAttribute("name"));
						}
						BoardUI.validation.createValidationErrorMessage(validationResponse, message);
					} else {
						runOnSave();
					}
				});

			  }(window, jQuery));

			function updateParent(){
				var parentid = parseInt($('#fk-holder').find('input').first().val());
				BoardScript.EditRecord(
					'',
					'BoardScript - Update Request',
					parentid,
					{},
					function(){}
				);
			}
			
			function wireAgency(){
				if(!($('#originating_agency_group').val().length)){
					var agency = '<for-each select="/data/groups"><if test="contains(@name,'Agency -')"><value-of select="@name" /></if></for-each>';
					if(agency.length &gt; 0){
						$('#originating_agency_group').val(agency);
						$('#originating_agency').val(agency.slice(9));
					}
				}
			}

			function addComment(){
				var obj = {};
				var dataid = parseInt($('#user-data-holder').attr('data-dataid'));
				var parentid = parseInt($('#fk-holder').find('input').first().val());
				var fkField = $('#fk-table-holder').text();
				var comment;
				if(dataid == 0){
					comment = 'Finance record created.';
				}else{
					comment = 'Finance record updated.';
				}
				var status = $('#user-data-holder').attr('data-status');
				var currentPosition = $('#user-data-holder').attr('data-positionname');
				var currentName = $('#user-data-holder').attr('data-realname');
				if(currentName == ''){
					currentName = $('#user-data-holder').attr('data-sessionname');
					if(currentName == ''){
						currentName = $('#user-data-holder').attr('data-username');
					}
				}
				var data = {
					'comment_comment' : comment,
					'comment_name' : currentName,
					'comment_position' : currentPosition,
					'comment_status' : status,
					'comment_remove' : ''
				};
				data[fkField] = parentid;
				$('#update_comments').val('');
				BoardScript.AddRecord(
					'',
					'BoardScript - History Input',
					data,
					function(){}
				);
			}

			function runOnSave(){
				updateParent();
				addComment();
			}
				</script>
  </body>
</html>